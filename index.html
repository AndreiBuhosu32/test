<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Auth Handshake</title>
    <style>
        :root {
            --sf-blue: #0176d3;
            --sf-green: #2e844a;
            --sf-gray: #f3f3f2;
            --text-main: #181818;
        }
        body {
            font-family: 'Salesforce Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #eef2f6 0%, #dae1e7 100%);
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; color: var(--text-main);
        }
        .card {
            background: white; width: 450px; padding: 40px; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center;
            border-top: 6px solid var(--sf-blue);
        }
        .logo { width: 80px; margin-bottom: 20px; }
        h1 { font-size: 24px; margin-bottom: 8px; color: var(--sf-blue); }
        p { color: #514f4d; margin-bottom: 30px; line-height: 1.5; font-size: 14px; }
        
        .status-container {
            background: var(--sf-gray); padding: 20px; border-radius: 12px;
            display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;
        }
        .status-item {
            display: flex; align-items: center; justify-content: space-between;
            font-size: 13px; font-weight: 600;
        }
        .badge {
            padding: 4px 10px; border-radius: 4px; font-size: 10px;
            text-transform: uppercase; background: #c9c7c5; color: white;
        }
        .badge.active { background: var(--sf-blue); }
        .badge.success { background: var(--sf-green); }

        .console-box {
            background: #161b22; color: #58a6ff; padding: 15px; border-radius: 8px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 12px; text-align: left; max-height: 120px; overflow-y: auto;
            border: 1px solid #30363d;
        }
    </style>
</head>
<body>

    <div class="card">
        <img src="https://upload.wikimedia.org/wikipedia/commons/f/f9/Salesforce.com_logo.svg" alt="SF" class="logo">
        <h1>Secure Handshake</h1>
        <p>Verified Identity + Manual Pre-Chat Input</p>

        <div class="status-container">
            <div class="status-item">
                <span>Messaging Engine</span>
                <span id="badge-engine" class="badge">Offline</span>
            </div>
            <div class="status-item">
                <span>Identity Verification (JWT)</span>
                <span id="badge-auth" class="badge">Waiting</span>
            </div>
        </div>

        <div id="debug-log" class="console-box">
            > Initializing secure tunnel...
        </div>
    </div>

    <script type='text/javascript'>
        const MY_TOKEN = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IlRlc3RLZXkxIn0.eyJpc3MiOiJteS1sb2NhbC10ZXN0LWlzc3VlciIsInN1YiI6InRlc3R1c2VyQGV4YW1wbGUuY29tIiwiZXhwIjoxOTk5OTk5OTk5fQ.n6MtGpINr41deswqhD4BTcSD8Vyih6SvtnhQ3RbQazZpkZuhL2CLen13ZfEbeeBRFtw_0d8i7kB2pO95134t6uox3sJvTUlStzzYIQITQRw7kidIyKrD6Wuo3pxWohz1oVJzidazY92AQFU0KM7k5fI3OXiAwwTdVSF1W3EJwsbuDb1WCzZkIEFB68r7vrNzJK6k6_09FEpwb5GCP5JmeP7tFF1TZhiRTJ3uMhimZVtZgw_7TVXtS4p0UujGrreDyrcWYkg4p6bRuCKl2B9V86-6iIlO-Ut97THOGcLAqDvgq7MfGr83jfr4BKEvQvLIGZLu7knE6-ZQvHBICwZ_KA";

        function log(msg) {
            const box = document.getElementById('debug-log');
            box.innerHTML += `<br>> ${msg}`;
            box.scrollTop = box.scrollHeight;
        }

        function initEmbeddedMessaging() {
            try {
                embeddedservice_bootstrap.settings.language = 'en_US';
                embeddedservice_bootstrap.init(
                    '00DS900000Dgm1o',
                    'Andrei1515',
                    'https://quartix--snowdrop.sandbox.my.site.com/ESWAndrei15151769699733620',
                    { scrt2URL: 'https://quartix--snowdrop.sandbox.my.salesforce-scrt.com' }
                );
                log("Bootstrap engine loaded.");
                document.getElementById('badge-engine').innerText = "Active";
                document.getElementById('badge-engine').classList.add('active');
            } catch (err) {
                log("LOAD ERROR: " + err);
            }
        };

        window.addEventListener("onEmbeddedMessagingReady", () => {
            log("Engine Ready. Performing Auth...");

            // SET IDENTITY TOKEN
            try {
                // Identity verification is handled via JWT; no pre-chat fields needed for this.
                embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
                    identityTokenType: "JWT",
                    identityToken: MY_TOKEN
                });
                log("JWT Handshake success.");
                document.getElementById('badge-auth').innerText = "Verified";
                document.getElementById('badge-auth').classList.add('success');
            } catch (e) {
                log("JWT Error: " + e.message);
            }

            // SHOW BUTTON (Fields will be blank as per Salesforce Setup)
            embeddedservice_bootstrap.util.showChatButton();
        });
    </script>

    <script type='text/javascript' 
            src='https://quartix--snowdrop.sandbox.my.site.com/ESWAndrei15151769699733620/assets/js/bootstrap.min.js' 
            onload='initEmbeddedMessaging()'>
    </script>

</body>
</html>
